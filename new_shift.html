<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ハピネスシフト管理</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
</head>
<body>
  <div class="container mt-5">
  <h2>1月10日</h2>
    <form>
      <!-- 店舗選択 -->
      <div class="form-group">
        <label>店舗選択:</label>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="central">
          <label class="form-check-label">セントラル</label>
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="cleaning_team">
          <label class="form-check-label">お片付け隊</label>
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="kids_room">
          <label class="form-check-label">キッズルーム</label>
        </div>
      </div>
      
      <!-- 時間選択 -->
      <div class="form-group">
        <label>時間選択:</label>
        <select class="form-control">
          <option value="08:00">8:00</option>
          <option value="08:15">8:15</option>
          <option value="08:30">8:30</option>
          <option value="08:45">8:45</option>
          <!-- 他の時間も必要に応じて追加 -->
        </select>
      </div>
      
      <!-- 場所・コメント -->
      <div class="form-group">
        <label for="locationComment">場所・コメント:</label>
        <input type="text" class="form-control" id="locationComment" placeholder="場所・コメントを入力">
      </div>
      
      <!-- 管理者へのコメント -->
      <div class="form-group">
        <label for="adminComment">管理者へのコメント:</label>
        <textarea class="form-control" id="adminComment" rows="3" placeholder="管理者へのコメントを入力"></textarea>
      </div>
      
      <!-- 送信ボタン -->
      <button type="submit" class="btn btn-primary">送信</button>
    </form>
  </div>
  <form class="w-75 mx-auto">
    <h2 class="form_title"></h2>
    <div class="my-4">
      <label for="shopSelection"><span style="color:red;">※</span>店舗の選択：</label>
      <select id="shopSelection" name="storeParam">
        <option value="セントラル">セントラル</option>
        <option value="お片付け隊">お片付け隊</option>
        <option value="キッズルーム">キッズルーム</option>
      </select>
    </div>
    <!-- hidden input要素 -->
    <input type="hidden" id="storeParamInput" name="storeParam" value="">
    <input type="submit" class="mt-4 btn btn-primary" value="送信">
  </form>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    //どこのお店のフォームか判別
    document.addEventListener("DOMContentLoaded", function() {
      const urlParams = new URLSearchParams(window.location.search);
      const storeParam = urlParams.get('store');
      console.log(storeParam);
      let titleText = '';

      if (storeParam === 'okataduke') {
        titleText = 'お片づけ隊';
      } else if (storeParam === 'central') {
        titleText = 'セントラル';
      } else if (storeParam === 'kidsroom') {
        titleText = 'キッズルーム';
      }

      const formTitleElement = document.querySelector('.form_title');
      const newTitle = document.createElement('h2');
      newTitle.textContent = `${titleText}シフト希望フォーム`;
      formTitleElement.parentNode.insertBefore(newTitle, formTitleElement);
      const storeParamInput = document.getElementById('storeParamInput');
      storeParamInput.value = storeParam;
    });
    
    const today = new Date();
    const day = today.getDate();
    const lastday = new Date(today.getFullYear(), today.getMonth() + 1, 0);

    function getWeekday(year, month, day) {
      const weekdays = ["日", "月", "火", "水", "木", "金", "土"];
      const date = new Date(year, month - 1, day);
      const weekdayIndex = date.getDay();
      return weekdays[weekdayIndex];
    }

  
    
 $(document).ready(function () {
     const liffId = "1661326584-85YGYPYw";
     initializeLiff(liffId);
 })

 function initializeLiff(liffId) {
        liff.init({
            liffId: liffId
        }).then(() => {
            initializeApp();
        }).catch((err) => {
            console.log('LIFF Initialization failed ', err);
        });
  }
    
  function sendText(text) {
      liff.sendMessages([{
          'type': 'text',
          'text': text
      }]).then(function () {
          liff.closeWindow();
      }).catch(function (error) {
          window.alert('Failed to send message ' + error);
      });
  }

  const params = (new URL(document.location)).searchParams;
  const key = params.get('key');

  $(function () {
      $('form').submit(function () {
          const store_param = $('[name="storeParam"]').val();
          let msg = `${store_param}シフト希望：`;
          let bikou = '備考：';
          let has_date = false;
          for (let i = 1; i < monthLastDay.getDate() + 1; i += 1) {
            if($('[name="day-start-' + i + '"]').val() && $('[name="day-end-' + i + '"]').val()){
              const day_date = $('[name="day-date-' + i + '"]').val();
              const start_time = $('[name="day-start-' + i + '"]').val();
              const end_time = $('[name="day-end-' + i + '"]').val();
              msg = msg + `\n${day_date}日: ${start_time}~${end_time}`;
              has_date = true;
            }
            if($('[name="day-bikou-' + i + '"]').val()){
              const day_date_bikou = $('[name="day-date-' + i + '"]').val();
              const bikou_text = $('[name="day-bikou-' + i + '"]').val();
              bikou = bikou + `\n${day_date_bikou}日: ${bikou_text}`;
            }
          }
          let message = has_date ? msg : msg +`\nなし`;
          message = bikou === '備考：' ? message + `\n` + bikou + `\nなし` : message + `\n` + bikou;
          sendText(message);
          return false;
      });
  });
  </script>
</body>
</html>
