<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ハピネスシフト管理</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
</head>
<body>
  <div class="container mt-5">
  <h2 id="dateInfo"></h2>
  <h2 id="dateInfo2"></h2>
  <h2 id="dateInfo3"></h2>
    <form>
      <!-- 店舗選択 -->
      <div class="form-group">
        <label>店舗選択:</label>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="central" checked>
          <label class="form-check-label">セントラル</label>
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="cleaning_team">
          <label class="form-check-label">お片付け隊</label>
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" name="store" value="kids_room">
          <label class="form-check-label">キッズルーム</label>
        </div>
      </div>
      
      <!-- 時間選択 -->
      <div class="form-group">
        <label>時間選択:</label>
        <select class="form-control">
          <option value="08:00">8:00</option>
          <option value="08:15">8:15</option>
          <option value="08:30">8:30</option>
          <option value="08:45">8:45</option>
          <option value="09:00">9:00</option>
          <option value="09:15">9:15</option>
          <option value="09:30">9:30</option>
          <option value="09:45">9:45</option>
          <option value="10:00">10:00</option>
          <option value="10:15">10:15</option>
          <option value="10:30">10:30</option>
          <option value="10:45">10:45</option>
          <option value="11:00">11:00</option>
          <option value="11:15">11:15</option>
          <option value="11:30">11:30</option>
          <option value="11:45">11:45</option>
          <option value="12:00">12:00</option>
          <option value="12:15">12:15</option>
          <option value="12:30">12:30</option>
          <option value="12:45">12:45</option>
          <option value="13:00">13:00</option>
          <option value="13:15">13:15</option>
          <option value="13:30">13:30</option>
          <option value="13:45">13:45</option>
          <option value="14:00">14:00</option>
          <option value="14:15">14:15</option>
          <option value="14:30">14:30</option>
          <option value="14:45">14:45</option>
          <option value="15:00">15:00</option>
          <option value="15:15">15:15</option>
          <option value="15:30">15:30</option>
          <option value="15:45">15:45</option>
          <option value="16:00">16:00</option>
          <option value="16:15">16:15</option>
          <option value="16:30">16:30</option>
          <option value="16:45">16:45</option>
          <option value="17:00">17:00</option>
          <option value="17:15">17:15</option>
          <option value="17:30">17:30</option>
          <option value="17:45">17:45</option>
          <option value="18:00">18:00</option>
          <option value="18:15">18:15</option>
          <option value="18:30">18:30</option>
          <option value="18:45">18:45</option>
          <option value="19:00">19:00</option>
          <option value="19:15">19:15</option>
          <option value="19:30">19:30</option>
          <option value="19:45">19:45</option>
          <option value="20:00">20:00</option>
          <option value="20:15">20:15</option>
          <option value="20:30">20:30</option>
          <option value="20:45">20:45</option>
          <option value="21:00">21:00</option>
          <option value="21:15">21:15</option>
          <option value="21:30">21:30</option>
          <option value="21:45">21:45</option>
          <option value="22:00">22:00</option>
          <option value="22:15">22:15</option>
          <option value="22:30">22:30</option>
          <option value="22:45">22:45</option>
          <option value="23:00">23:00</option>
          <option value="23:15">23:15</option>
          <option value="23:30">23:30</option>
          <option value="23:45">23:45</option>
          <option value="00:00">00:00</option>
          <option value="00:15">00:15</option>
          <option value="00:30">00:30</option>
          <option value="00:45">00:45</option>
          <option value="01:00">01:00</option>
          <option value="01:15">01:15</option>
          <option value="01:30">01:30</option>
          <option value="01:45">01:45</option>
          <option value="02:00">02:00</option>
          <option value="02:15">02:15</option>
          <option value="02:30">02:30</option>
          <option value="02:45">02:45</option>
          <option value="03:00">03:00</option>
          <option value="03:15">03:15</option>
          <option value="03:30">03:30</option>
          <option value="03:45">03:45</option>
          <option value="04:00">04:00</option>
          <option value="04:15">04:15</option>
          <option value="04:30">04:30</option>
          <option value="04:45">04:45</option>
          <option value="05:00">05:00</option>
          <option value="05:15">05:15</option>
          <option value="05:30">05:30</option>
          <option value="05:45">05:45</option>
          <option value="06:00">06:00</option>
          <option value="06:15">06:15</option>
          <option value="06:30">06:30</option>
          <option value="06:45">06:45</option>
          <option value="07:00">07:00</option>
          <option value="07:15">07:15</option>
          <option value="07:30">07:30</option>
          <option value="07:45">07:45</option>
        </select> 
        <p class="mx-1 my-auto">〜</p>
        <select class="form-control">
        <option value="08:00">8:00</option>
          <option value="08:15">8:15</option>
          <option value="08:30">8:30</option>
          <option value="08:45">8:45</option>
          <option value="09:00">9:00</option>
          <option value="09:15">9:15</option>
          <option value="09:30">9:30</option>
          <option value="09:45">9:45</option>
          <option value="10:00">10:00</option>
          <option value="10:15">10:15</option>
          <option value="10:30">10:30</option>
          <option value="10:45">10:45</option>
          <option value="11:00">11:00</option>
          <option value="11:15">11:15</option>
          <option value="11:30">11:30</option>
          <option value="11:45">11:45</option>
          <option value="12:00">12:00</option>
          <option value="12:15">12:15</option>
          <option value="12:30">12:30</option>
          <option value="12:45">12:45</option>
          <option value="13:00">13:00</option>
          <option value="13:15">13:15</option>
          <option value="13:30">13:30</option>
          <option value="13:45">13:45</option>
          <option value="14:00">14:00</option>
          <option value="14:15">14:15</option>
          <option value="14:30">14:30</option>
          <option value="14:45">14:45</option>
          <option value="15:00">15:00</option>
          <option value="15:15">15:15</option>
          <option value="15:30">15:30</option>
          <option value="15:45">15:45</option>
          <option value="16:00">16:00</option>
          <option value="16:15">16:15</option>
          <option value="16:30">16:30</option>
          <option value="16:45">16:45</option>
          <option value="17:00">17:00</option>
          <option value="17:15">17:15</option>
          <option value="17:30">17:30</option>
          <option value="17:45">17:45</option>
          <option value="18:00">18:00</option>
          <option value="18:15">18:15</option>
          <option value="18:30">18:30</option>
          <option value="18:45">18:45</option>
          <option value="19:00">19:00</option>
          <option value="19:15">19:15</option>
          <option value="19:30">19:30</option>
          <option value="19:45">19:45</option>
          <option value="20:00">20:00</option>
          <option value="20:15">20:15</option>
          <option value="20:30">20:30</option>
          <option value="20:45">20:45</option>
          <option value="21:00">21:00</option>
          <option value="21:15">21:15</option>
          <option value="21:30">21:30</option>
          <option value="21:45">21:45</option>
          <option value="22:00">22:00</option>
          <option value="22:15">22:15</option>
          <option value="22:30">22:30</option>
          <option value="22:45">22:45</option>
          <option value="23:00">23:00</option>
          <option value="23:15">23:15</option>
          <option value="23:30">23:30</option>
          <option value="23:45">23:45</option>
          <option value="00:00">00:00</option>
          <option value="00:15">00:15</option>
          <option value="00:30">00:30</option>
          <option value="00:45">00:45</option>
          <option value="01:00">01:00</option>
          <option value="01:15">01:15</option>
          <option value="01:30">01:30</option>
          <option value="01:45">01:45</option>
          <option value="02:00">02:00</option>
          <option value="02:15">02:15</option>
          <option value="02:30">02:30</option>
          <option value="02:45">02:45</option>
          <option value="03:00">03:00</option>
          <option value="03:15">03:15</option>
          <option value="03:30">03:30</option>
          <option value="03:45">03:45</option>
          <option value="04:00">04:00</option>
          <option value="04:15">04:15</option>
          <option value="04:30">04:30</option>
          <option value="04:45">04:45</option>
          <option value="05:00">05:00</option>
          <option value="05:15">05:15</option>
          <option value="05:30">05:30</option>
          <option value="05:45">05:45</option>
          <option value="06:00">06:00</option>
          <option value="06:15">06:15</option>
          <option value="06:30">06:30</option>
          <option value="06:45">06:45</option>
          <option value="07:00">07:00</option>
          <option value="07:15">07:15</option>
          <option value="07:30">07:30</option>
          <option value="07:45">07:45</option>
        </select> 
      </div>
      
      <!-- 場所・コメント -->
      <div class="form-group">
        <label for="locationComment">場所・コメント:</label>
        <input type="text" class="form-control" id="locationComment" placeholder="場所・コメントを入力">
      </div>
      
      <!-- 管理者へのコメント -->
      <div class="form-group">
        <label for="adminComment">管理者へのコメント:</label>
        <textarea class="form-control" id="adminComment" rows="3" placeholder="管理者へのコメントを入力"></textarea>
      </div>
      
      <!-- 送信ボタン -->
      <button type="submit" class="btn btn-primary">送信</button>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    //どこのお店のフォームか判別
    document.addEventListener("DOMContentLoaded", function() {      
      const queryString = decodeURIComponent(window.location.search).replace(
        '?liff.state=',
        ''
      )
      const urlParams = new URLSearchParams(queryString)
      const dateParam = urlParams.get('date');
      
      // ハイフンをスラッシュに置換することで標準的な形式に変換
      const standardDateFormat = dateParam.replace(/-/g, '/');
      const dateObj = new Date(standardDateFormat);
      
      // 年、月、日、曜日を取得
      const year = dateObj.getFullYear();
      const month = dateObj.getMonth() + 1; // 月は0から始まるため+1する
      const day = dateObj.getDate();
      const dayOfWeek = ['日', '月', '火', '水', '木', '金', '土'][dateObj.getDay()];
    
      // h2要素に日付情報を表示
      const dateInfoElement = document.getElementById('dateInfo');
      dateInfoElement.textContent = `${year}年${month}月${day}日（${dayOfWeek}）`;
      
      let titleText = '';

      if (storeParam === 'okataduke') {
        titleText = 'お片づけ隊';
      } else if (storeParam === 'central') {
        titleText = 'セントラル';
      } else if (storeParam === 'kidsroom') {
        titleText = 'キッズルーム';
      }

      const formTitleElement = document.querySelector('.form_title');
      const newTitle = document.createElement('h2');
      newTitle.textContent = `${titleText}シフト希望フォーム`;
      formTitleElement.parentNode.insertBefore(newTitle, formTitleElement);
      const storeParamInput = document.getElementById('storeParamInput');
      storeParamInput.value = storeParam;
    });
    
    const today = new Date();
    const day = today.getDate();
    const lastday = new Date(today.getFullYear(), today.getMonth() + 1, 0);

    function getWeekday(year, month, day) {
      const weekdays = ["日", "月", "火", "水", "木", "金", "土"];
      const date = new Date(year, month - 1, day);
      const weekdayIndex = date.getDay();
      return weekdays[weekdayIndex];
    }

  
    
 $(document).ready(function () {
     const liffId = "1661326584-85YGYPYw";
     initializeLiff(liffId);
 })

 function initializeLiff(liffId) {
        liff.init({
            liffId: liffId
        }).then(() => {
            initializeApp();
        }).catch((err) => {
            console.log('LIFF Initialization failed ', err);
        });

        liff.ready.then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          }
          const idToken = liff.getDecodedIDToken();
          const userId = idToken.sub;
          const dateInfoElement2 = document.getElementById('dateInfo2');;
          dateInfoElement2.textContent = "$LIFF_ID";
          console.log("$LIFF_ID");
        })
  }
    
  function sendText(text) {
      liff.sendMessages([{
          'type': 'text',
          'text': text
      }]).then(function () {
          liff.closeWindow();
      }).catch(function (error) {
          window.alert('Failed to send message ' + error);
      });
  }

  const params = (new URL(document.location)).searchParams;
  const key = params.get('key');

  $(function () {
      $('form').submit(function () {
          const store_param = $('[name="storeParam"]').val();
          let msg = `${store_param}シフト希望：`;
          let bikou = '備考：';
          let has_date = false;
          for (let i = 1; i < monthLastDay.getDate() + 1; i += 1) {
            if($('[name="day-start-' + i + '"]').val() && $('[name="day-end-' + i + '"]').val()){
              const day_date = $('[name="day-date-' + i + '"]').val();
              const start_time = $('[name="day-start-' + i + '"]').val();
              const end_time = $('[name="day-end-' + i + '"]').val();
              msg = msg + `\n${day_date}日: ${start_time}~${end_time}`;
              has_date = true;
            }
            if($('[name="day-bikou-' + i + '"]').val()){
              const day_date_bikou = $('[name="day-date-' + i + '"]').val();
              const bikou_text = $('[name="day-bikou-' + i + '"]').val();
              bikou = bikou + `\n${day_date_bikou}日: ${bikou_text}`;
            }
          }
          let message = has_date ? msg : msg +`\nなし`;
          message = bikou === '備考：' ? message + `\n` + bikou + `\nなし` : message + `\n` + bikou;
          sendText(message);
          return false;
      });
  });
  </script>
</body>
</html>
