<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ハピネスシフト管理 赤枠提出</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
</head>
<body>
  <form class="w-75 mx-auto">
    <h2>赤枠希望</h2>
    <p>※出勤可能な時間に変更して提出してください。</p>
    <div class='place my-2'>店舗: </div>
    <div class='date my-2'>日付: </div>
    <div class='time my-2'>時間:</div>
    <div class='comment my-2'>
      <label for="story">備考:</label>
      <textarea id="comment" name="comment" rows="5" cols="33">
      </textarea>
    </div>
    
    <input type="submit" class="mt-4 btn btn-primary" value="送信">
  </form>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    const option = `
  <option value="08:00">08:00</option>
  <option value="08:15">08:15</option>
  <option value="08:30">08:30</option>
  <option value="08:45">08:45</option>
  <option value="09:00">09:00</option>
  <option value="09:15">09:15</option>
  <option value="09:30">09:30</option>
  <option value="09:45">09:45</option>
  <option value="10:00">10:00</option>
  <option value="10:15">10:15</option>
  <option value="10:30">10:30</option>
  <option value="10:45">10:45</option>
  <option value="11:00">11:00</option>
  <option value="11:15">11:15</option>
  <option value="11:30">11:30</option>
  <option value="11:45">11:45</option>
  <option value="12:00">12:00</option>
  <option value="12:15">12:15</option>
  <option value="12:30">12:30</option>
  <option value="12:45">12:45</option>
  <option value="13:00">13:00</option>
  <option value="13:15">13:15</option>
  <option value="13:30">13:30</option>
  <option value="13:45">13:45</option>
  <option value="14:00">14:00</option>
  <option value="14:15">14:15</option>
  <option value="14:30">14:30</option>
  <option value="14:45">14:45</option>
  <option value="15:00">15:00</option>
  <option value="15:15">15:15</option>
  <option value="15:30">15:30</option>
  <option value="15:45">15:45</option>
  <option value="16:00">16:00</option>
  <option value="16:15">16:15</option>
  <option value="16:30">16:30</option>
  <option value="16:45">16:45</option>
  <option value="17:00">17:00</option>
  <option value="17:15">17:15</option>
  <option value="17:30">17:30</option>
  <option value="17:45">17:45</option>
  <option value="18:00">18:00</option>
  <option value="18:15">18:15</option>
  <option value="18:30">18:30</option>
  <option value="18:45">18:45</option>
  <option value="19:00">19:00</option>
  <option value="19:15">19:15</option>
  <option value="19:30">19:30</option>
  <option value="19:45">19:45</option>
  <option value="20:00">20:00</option>
  <option value="20:15">20:15</option>
  <option value="20:30">20:30</option>
  <option value="20:45">20:45</option>
  <option value="21:00">21:00</option>
  <option value="21:15">21:15</option>
  <option value="21:30">21:30</option>
  <option value="21:45">21:45</option>
  <option value="22:00">22:00</option>
  <option value="22:15">22:15</option>
  <option value="22:30">22:30</option>
  <option value="22:45">22:45</option>
  <option value="23:00">23:00</option>
  <option value="23:15">23:15</option>
  <option value="23:30">23:30</option>
  <option value="23:45">23:45</option>
  <option value="00:00">00:00</option>
  <option value="00:15">00:15</option>
  <option value="00:30">00:30</option>
  <option value="00:45">00:45</option>
  <option value="01:00">01:00</option>
  <option value="01:15">01:15</option>
  <option value="01:30">01:30</option>
  <option value="01:45">01:45</option>
  <option value="02:00">02:00</option>
  <option value="02:15">02:15</option>
  <option value="02:30">02:30</option>
  <option value="02:45">02:45</option>
  <option value="03:00">03:00</option>
  <option value="03:15">03:15</option>
  <option value="03:30">03:30</option>
  <option value="03:45">03:45</option>
  <option value="04:00">04:00</option>
  <option value="04:15">04:15</option>
  <option value="04:30">04:30</option>
  <option value="04:45">04:45</option>
  <option value="05:00">05:00</option>
  <option value="05:15">05:15</option>
  <option value="05:30">05:30</option>
  <option value="05:45">05:45</option>
  <option value="06:00">06:00</option>
  <option value="06:15">06:15</option>
  <option value="06:30">06:30</option>
  <option value="06:45">06:45</option>
  <option value="07:00">07:00</option>
  <option value="07:15">07:15</option>
  <option value="07:30">07:30</option>
  <option value="07:45">07:45</option>`;

const url = location.search;
const parsedParams = parseURLParameters(url);

// パースされたパラメータを変数に代入
const place = parsedParams.place;
const date = parsedParams.date;
const start = parsedParams.start;
const end = parsedParams.end;

const $timeInnerContainer = $('<div class="d-flex"></div>');
$timeInnerContainer.append(
    `<select class="col-5" name="start_time" id="start_time"><option value="${start}" selected>${start}</option>${option}</select>`,
    `<p class="mx-1 my-auto">〜</p>`,
    `<select class="col-5" name="end_time" id="end_time"><option value="${end}" selected>${end}</option>${option}</select>`,
);
    
$('.place').append(`<p>${place}</p><input type="text" name="input_date" value="${place}" class="sample" style="display:none;" />`);
$('.date').append(`<p>${date}</p><input type="text" name="input_date" value="${date}" class="sample" style="display:none;" />`);
$('.time').append($timeInnerContainer);


 $(document).ready(function () {
     const liffId = "1661326584-85YGYPYw";
     initializeLiff(liffId);
 })

function parseURLParameters(url) {
    // URLからクエリ文字列を取得
    const queryString = url.split('?')[1];

    // クエリ文字列を & で分割し、各パラメータを処理
    const parameters = queryString.split('&');
    const result = {};

    parameters.forEach(param => {
        const [key, value] = param.split('=');

        // キーと値をデコードして結果オブジェクトに追加
        result[key] = decodeURIComponent(value);
    });

    return result;
}

 function initializeLiff(liffId) {
        liff.init({
            liffId: liffId
        }).then(() => {
            initializeApp();
        }).catch((err) => {
            console.log('LIFF Initialization failed ', err);
        });
  }
    
  function sendText(text) {
      liff.sendMessages([{
          'type': 'text',
          'text': text
      }]).then(function () {
          liff.closeWindow();
      }).catch(function (error) {
          window.alert('Failed to send message ' + error);
      });
  }

  const params = (new URL(document.location)).searchParams;
  const key = params.get('key');

  $(function () {
      $('form').submit(function () {
          const place = $('[name="place"]').val();
          const date = $('[name="input_date"]').val();
          const start_time = $('[name="start_time"]').val();
          const end_time = $('[name="end_time"]').val();
          const bikou = $('[name="comment"]').val();
        
          const message = `赤枠希望：\n${place}\n${date}\n${start_time}\n${end_time}\n${bikou}`;
          sendText(message);
          return false;
      });
  });
  </script>
</body>
</html>
